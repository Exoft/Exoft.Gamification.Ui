<div class="main-container">
  <mat-card class="card">

    <mat-tab-group class="link" (selectedTabChange)="onAdminTabChange($event)">
      <mat-tab label="Users">
        <ng-template matTabContent>
          <table *ngIf="isInfoLoaded" mat-table [dataSource]="dataSourceUser" class="user-table">
            <ng-container matColumnDef="avatar">
              <th mat-header-cell *matHeaderCellDef>Avatar</th>

              <td mat-cell *matCellDef="let element">
                <div *ngIf="element.avatarId else textAvatar"
                     class="avatar"
                     [ngStyle]="{'background-image' : 'url(' + getImageUrl(element.avatarId)+ ')'}"></div>

                <ng-template #textAvatar>
                  <div class="avatar-text">
                    {{letterAvatar(element.firstName, element.lastName)}}
                  </div>
                </ng-template>
              </td>
            </ng-container>

            <ng-container matColumnDef="firstName">
              <th mat-header-cell *matHeaderCellDef> First name</th>

              <td mat-cell *matCellDef="let element"> {{element.firstName}} </td>
            </ng-container>

            <ng-container matColumnDef="lastName">
              <th mat-header-cell *matHeaderCellDef> Last name</th>

              <td mat-cell *matCellDef="let element"> {{element.lastName}} </td>
            </ng-container>

            <ng-container matColumnDef="xp">
              <th mat-header-cell *matHeaderCellDef> XP</th>

              <td mat-cell *matCellDef="let element"> {{element.xp}} </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>
                <button mat-button class="add" (click)="onOpenAddUser()">Add</button>
              </th>

              <td mat-cell class="admin-page-actions" *matCellDef="let user; let i=index;">
                <button mat-button
                        class="update"
                        (click)="onOpenEditUser(user.id)">
                  Edit
                </button>

                <button mat-button
                        class="delete"
                        [ngClass]="currentUser.get('id').value==user.id?'invisible':''"
                        (click)="onOpenDeleteUser(user)">
                  Delete
                </button>

                <button mat-button
                        class="update"
                        (click)="openAssignAchievementWindow(user)">
                  Achievements
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumnsUser"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumnsUser;"></tr>
          </table>

          <mat-paginator #userPaginator
                         [length]="userPaginatorTotalItems"
                         [pageSize]="userFilterForm?.get('limit')?.value"
                         [pageSizeOptions]="paginatorPageSizeOptions"
                         (page)="paginatorEvent($event, userFilterForm); loadUserData();"
                         [pageIndex]="+userFilterForm?.get('page')?.value - 1"></mat-paginator>
        </ng-template>
      </mat-tab>


      <mat-tab label="Achievements">
        <ng-template matTabContent>
          <table mat-table [dataSource]="dataSourceAchievements" class="user-table">
            <ng-container matColumnDef="icon">
              <th mat-header-cell *matHeaderCellDef>Icon</th>

              <td mat-cell *matCellDef="let element">
                <img *ngIf="element.iconId" class="avatar" [src]="getImageUrl(element.iconId)">
              </td>
            </ng-container>


            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef> Name</th>
              <td mat-cell *matCellDef="let achievement"> {{achievement.name}} </td>
            </ng-container>

            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef> Description</th>
              <td mat-cell *matCellDef="let achievement"> {{achievement.description}} </td>
            </ng-container>

            <ng-container matColumnDef="xp">
              <th mat-header-cell *matHeaderCellDef> XP</th>
              <td mat-cell *matCellDef="let achievement"> {{achievement.xp}} </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>
                <button mat-button class="add" (click)="onOpenAddAchievement()">Add</button>
              </th>

              <td mat-cell *matCellDef="let achievement; let i=index;">
                <button mat-button class="update" (click)="onOpenEditAchievement(achievement)">Edit</button>
                <button mat-button class="delete" (click)="onOpenDeleteAchievement(achievement)">Delete</button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumnsAchievements"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumnsAchievements;"></tr>
          </table>

          <mat-paginator #achievementPaginator
                         [length]="achievementPaginatorTotalItems"
                         [pageSize]="achievementFilterForm?.get('limit')?.value"
                         [pageSizeOptions]="paginatorPageSizeOptions"
                         (page)="paginatorEvent($event, achievementFilterForm); loadAchievementsData();"
                         [pageIndex]="+achievementFilterForm?.get('page')?.value - 1"></mat-paginator>
        </ng-template>
      </mat-tab>

      <mat-tab label="Achievement Requests">
        <ng-template matTabContent>
          <table *ngIf="isInfoLoaded" mat-table [dataSource]="dataSourceAchievementRequest" class="user-table">

            <ng-container matColumnDef="userName">
              <th mat-header-cell *matHeaderCellDef> User Name</th>
              <td mat-cell *matCellDef="let element"> {{element.userName}} </td>
            </ng-container>

            <ng-container matColumnDef="achievement">
              <th mat-header-cell *matHeaderCellDef> Achievement</th>
              <td mat-cell *matCellDef="let element"> {{element.achievementName}} </td>
            </ng-container>

            <ng-container matColumnDef="comment">
              <th mat-header-cell *matHeaderCellDef> Comment</th>
              <td mat-cell *matCellDef="let element"> {{element.message}} </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Choose Destiny</th>

              <td mat-cell class="admin-page-actions" *matCellDef="let element">
                <button mat-button class="approve" (click)="onRequestDecision(element,true)">
                  <mat-icon>check</mat-icon>
                </button>
                <button mat-button class="decline" (click)="onRequestDecision(element,false)">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumnsAchievementsRequests"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumnsAchievementsRequests;"></tr>
          </table>
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  </mat-card>
</div>
